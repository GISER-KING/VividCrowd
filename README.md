# VividCrowd

> **åŸºäº LLM çš„é«˜ä»¿çœŸæ²‰æµ¸å¼æ‹Ÿäººç¾¤èŠç¯å¢ƒ + AI æ•°å­—åˆ†èº«æ™ºåº“ + æ™ºèƒ½å®¢æœç³»ç»Ÿ**

https://github.com/user-attachments/assets/26936c51-f9d9-4590-896c-8e093f7a41ff

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Python 3.9+](https://img.shields.io/badge/python-3.9+-blue.svg)](https://www.python.org/downloads/)
[![FastAPI](https://img.shields.io/badge/FastAPI-0.115+-009688.svg)](https://fastapi.tiangolo.com/)
[![React](https://img.shields.io/badge/React-18-61DAFB.svg)](https://react.dev/)

[English Version](README_EN.md)

---

## ğŸ“– é¡¹ç›®ç®€ä»‹

**VividCrowd** æ˜¯ä¸€ä¸ªå¤šæ¨¡æ€ AI å¯¹è¯å¹³å°ï¼Œæä¾›å››ç§ç‹¬ç‰¹çš„äº¤äº’ä½“éªŒï¼š

| æ¨¡å¼ | æè¿° | ç‰¹ç‚¹ |
|------|------|------|
| **æ™ºèƒ½ç¾¤èŠ** | ä½ æ˜¯å”¯ä¸€çš„çœŸäººï¼Œä¸å¤šä¸ª AI Agent ç»„æˆçš„è™šæ‹Ÿç¾¤èŠ | æ·±åº¦æ‹ŸäººåŒ–ã€æ··åˆè·¯ç”±ã€é˜²ç©¿å¸® |
| **æ•°å­—åˆ†èº«** | ä¸Šä¼  PDF åˆ›å»ºåäºº/ä¹¦ç±/è¯¾ç¨‹çš„ AI æ•°å­—åˆ†èº« | çŸ¥è¯†æå–ã€ç§èŠ/ç¾¤èŠã€æ•°å­—äººè§†é¢‘ |
| **æ•°å­—å®¢æœ** | åŸºäºçŸ¥è¯†åº“çš„æ™ºèƒ½å®¢æœç³»ç»Ÿ | BM25+Embedding æ··åˆåŒ¹é…ã€ç½®ä¿¡åº¦åˆ†å±‚ã€è¯æœ¯æ§åˆ¶ |
| **é”€å”®æ¼”ç»ƒ** | æ¨¡æ‹ŸçœŸå®å®¢æˆ·è¿›è¡Œé”€å”®å…¨æµç¨‹å®æˆ˜æ¼”ç»ƒ | 5é˜¶æ®µæµç¨‹ã€å®æ—¶è¯„ä»·ã€AIåŠ©æ‰‹ã€é›·è¾¾å›¾åˆ†æ |

ä¸ä¼ ç»Ÿçš„"ä¸€é—®ä¸€ç­”"æœºå™¨äººä¸åŒï¼Œæœ¬é¡¹ç›®é€šè¿‡å¤æ‚çš„**ç¼–æ’ç®—æ³•**å’Œ**æ‹ŸäººåŒ–ç­–ç•¥**ï¼Œæ¨¡æ‹Ÿäº†çœŸå®çš„ç¤¾äº¤ç›´è§‰å’Œä¸“ä¸šæœåŠ¡ä½“éªŒã€‚

---

## ğŸŒŸ æ ¸å¿ƒåŠŸèƒ½

### ä¸€ã€æ™ºèƒ½ç¾¤èŠ (Group Chat)

#### 1.1 æ·±åº¦æ‹ŸäººåŒ– Agent

æ¯ä¸ªç¾¤å‹éƒ½åŸºäº `agents_profiles.json` å®šä¹‰ï¼Œæ‹¥æœ‰ç‹¬ç«‹çš„çµé­‚ï¼š

```json
{
  "id": "xiaolin",
  "name": "å°æ—",
  "age": 22,
  "occupation": "ä¸­åŒ»é™¢æ ¡å­¦ç”Ÿ",
  "personality_traits": ["çƒ­å¿ƒ", "è¯ç—¨", "æœ‰ç‚¹è¿·ä¿¡"],
  "interests": ["èˆŒè¯Š", "å…»ç”ŸèŒ¶", "èŠ‚æ°”é£Ÿç–—"],
  "speech_style": "ç”¨'å§å¦¹''å®å­'ç§°å‘¼åˆ«äººï¼Œçˆ±å‘æ³¢æµªå·ï½"
}
```

**æ ¸å¿ƒç‰¹æ€§ï¼š**

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **ä¸¥æ ¼äººè®¾æ¨¡å¼** | Agent ä¸¥æ ¼éµå®ˆäººè®¾ï¼Œä¸­åŒ»å­¦ç”Ÿä¸ä¼šå›ç­” Python é—®é¢˜ |
| **å AI æŒ‡ä»¤æ³¨å…¥** | System Prompt å¼ºåˆ¶å¿˜è®° AI èº«ä»½ï¼Œä½¿ç”¨å£è¯­åŒ–è¡¨è¾¾ |
| **æ¯æ—¥æ¶ˆæ¯é™åˆ¶** | æ¯ä¸ª Agent æ¯å¤©æœ€å¤šå‘ 10 æ¡ï¼Œæ¨¡æ‹ŸçœŸäººæ´»è·ƒåº¦ |
| **é¢†åŸŸæ‹’ç­”** | è¶…å‡ºä¸“ä¸šé¢†åŸŸçš„é—®é¢˜ä¼šè¯´"è¿™é¢˜è¶…çº²äº†" |

#### 1.2 æ™ºèƒ½æ··åˆè·¯ç”±æ¶æ„

é‡‡ç”¨ **Fast & Slow** åŒè·¯å¾„åˆ†å‘æœºåˆ¶ï¼š

```
ç”¨æˆ·æ¶ˆæ¯
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš¡ Fast Path (è§„åˆ™å±‚ - æ¯«ç§’çº§)      â”‚
â”‚  â”œâ”€ æ˜¾å¼æåŠ: @å¼ é¥ â†’ ç›´æ¥é”å®š       â”‚
â”‚  â””â”€ ç„¦ç‚¹ä¿æŒ: ä¸Šä¸€è½®å‘è¨€è€…ä¼˜å…ˆå›å¤   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ (æœªå‘½ä¸­)
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¢ Slow Path (è¯­ä¹‰å±‚ - ç§’çº§)        â”‚
â”‚  â””â”€ LLM Router (Qwen-Turbo) åˆ†ææ„å›¾â”‚
â”‚     "è°èƒ½å¸®æˆ‘çœ‹ä¸ªä»£ç ï¼Ÿ" â†’ å¼ é¥      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ (æœªå‘½ä¸­)
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ² éšæœºè¡¥ä½ (30%æ¦‚ç‡è§¦å‘é—²èŠ)       â”‚
â”‚  â””â”€ æ·±å¤œæ¨¡å¼è‡ªåŠ¨é™ä½æ´»è·ƒåº¦           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 1.3 çœŸå®ç¾¤èŠä½“éªŒ

| ç‰¹æ€§ | å®ç°æ–¹å¼ |
|------|---------|
| **åå°å¹¶å‘ï¼Œå‰å°ä¸²è¡Œ** | å¤š Agent åŒæ—¶æ€è€ƒï¼Œä½†é€šè¿‡é˜Ÿåˆ—ä¸²è¡Œå‘è¨€ |
| **è¾“å…¥çŠ¶æ€æ¨¡æ‹Ÿ** | æ˜¾ç¤º"xxx æ­£åœ¨è¾“å…¥..."ï¼Œå®Œæ•´æ¶ˆæ¯ä¸€æ¬¡å¼¹å‡º |
| **æ™ºèƒ½å»é‡** | è‡ªåŠ¨æ£€æµ‹å¤è¯»æœºè¡Œä¸ºï¼Œææ–­æ— æ•ˆå›å¤ |
| **æ·±å¤œæ¨¡å¼** | 23:00-07:00 æ´»è·ƒåº¦é™è‡³ 20%ï¼Œæœ€å¤š 1 äººå›å¤ |
| **æ‰“å­—å»¶è¿Ÿ** | 8-10 ç§’æ¨¡æ‹ŸçœŸäººæ€è€ƒæ—¶é—´ |

#### 1.4 å¤šé‡å®‰å…¨å›´æ 

```python
# ä¸‰å±‚é˜²æŠ¤æœºåˆ¶
ç¬¬1å±‚: æ­£åˆ™åŒ¹é… (æ¯«ç§’çº§)
  - å…³é”®è¯: "æ‰®æ¼”", "ä½ æ˜¯AIå—", "æœºå™¨äºº"
  - æ¨¡å¼: r"^(å¦‚æœ|å‡å¦‚)ä½ æ˜¯.*"

ç¬¬2å±‚: ä¸Šä¸‹æ–‡åˆ†æ
  - æ£€æµ‹è¿ç»­è¿½é—®ä¸ªäººéšç§

ç¬¬3å±‚: LLMæ„å›¾è¯†åˆ« (10%é‡‡æ ·)
  - ç²¾å‡†è¯†åˆ«ç ´é˜²ä¼å›¾
```

**é˜²ç©¿å¸®å“åº”ç¤ºä¾‹ï¼š**
```
ç”¨æˆ·: ä½ æ˜¯AIå—ï¼Ÿ
å°æ—: å•Šï¼Ÿä½ åœ¨é€—æˆ‘ç©å—ï½åˆ«æ•´è¿™äº›å¥‡å¥‡æ€ªæ€ªçš„å•¦ï¼
```

---

### äºŒã€æ•°å­—åˆ†èº«æ™ºåº“ (Digital Twins)

#### 2.1 PDF æ™ºèƒ½è§£æ

æ”¯æŒä¸‰ç§çŸ¥è¯†æºç±»å‹ï¼š

| ç±»å‹ | é€‚ç”¨åœºæ™¯ | æå–å†…å®¹ |
|------|---------|---------|
| **äººç‰© (Person)** | åäººä¼ è®°ã€äººç‰©ä»‹ç» | å§“åã€ç”Ÿå’å¹´ã€å›½ç±ã€èŒä¸šã€æ€§æ ¼ã€è¯­å½• |
| **ä¹¦ç± (Book)** | ç»å…¸è‘—ä½œã€å­¦æœ¯ä¹¦ç± | ä½œè€…ã€æ ¸å¿ƒè§‚ç‚¹ã€åè¨€é‡‘å¥ã€è¡¨è¾¾é£æ ¼ |
| **è¯¾ç¨‹ (Topic)** | è¯¾ç¨‹è®²ä¹‰ã€ä¸“é¢˜èµ„æ–™ | è®²å¸ˆã€æ ¸å¿ƒæ¦‚å¿µã€çŸ¥è¯†ç‚¹ |

**è§£ææµç¨‹ï¼š**

```
PDFä¸Šä¼ 
    â”‚
    â–¼
1. PyMuPDF æå–æ–‡æœ¬
    â”‚
    â–¼
2. LLM ç»“æ„åŒ–è§£æ (Qwen)
   {
     "name": "çˆ±å› æ–¯å¦",
     "occupation": "ç†è®ºç‰©ç†å­¦å®¶",
     "famous_quotes": "æƒ³è±¡åŠ›æ¯”çŸ¥è¯†æ›´é‡è¦...",
     "speech_style": "æ·±é‚ƒã€å–„äºæ¯”å–»"
   }
    â”‚
    â–¼
3. è‡ªåŠ¨ç”Ÿæˆ System Prompt
    â”‚
    â–¼
4. å­˜å‚¨è‡³æ•°æ®åº“
```

#### 2.2 å¤šæ¨¡æ€äº¤äº’ä½“éªŒ

| æ¨¡æ€ | æŠ€æœ¯å®ç° | è¯´æ˜ |
|------|---------|------|
| **è¯­éŸ³ (Audio)** | DashScope Paraformer-Realtime | å®æ—¶è¯­éŸ³è¯†åˆ«ä¸åˆæˆï¼Œæ”¯æŒè‡ªç„¶è¯­éŸ³å¯¹è¯ |
| **è§†é¢‘ (Video)** | ç«å±±å¼•æ“ (Volcano Engine) | å•å›¾éŸ³é¢‘é©±åŠ¨æŠ€æœ¯ï¼Œè®©é™æ€ç…§ç‰‡"å¼€å£è¯´è¯" |

#### 2.3 åŒæ¨¡å¼å¯¹è¯

| æ¨¡å¼ | ç‰¹ç‚¹ | å›å¤é•¿åº¦ |
|------|------|---------|
| **ç§èŠ (Private)** | ä¸€å¯¹ä¸€æ·±åº¦å¯¹è¯ | 100-200 å­— |
| **ç¾¤èŠ (Group)** | å¤šäººæ€æƒ³ç¢°æ’ï¼Œæ™ºå›Šå›¢è®¨è®º | 50 å­—ä»¥å†… |

**ç¾¤èŠæ¨¡å¼ç¤ºä¾‹ï¼š**
```
ç”¨æˆ·: å¦‚ä½•çœ‹å¾…äººå·¥æ™ºèƒ½çš„æœªæ¥ï¼Ÿ

çˆ±å› æ–¯å¦: æŠ€æœ¯æœ¬èº«æ˜¯ä¸­æ€§çš„ï¼Œå…³é”®åœ¨äºäººç±»å¦‚ä½•è¿ç”¨å®ƒ...
å­”å­: å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ã€‚ç„¶è€Œï¼Œå™¨ä¹‹å–„æ¶ï¼Œåœ¨äºç”¨è€…ä¹‹å¿ƒ...
ä¹”å¸ƒæ–¯: æŠ€æœ¯å’Œäººæ–‡çš„äº¤æ±‡ç‚¹ï¼Œæ‰æ˜¯çœŸæ­£çš„åˆ›æ–°æ‰€åœ¨...
```

#### 2.4 çŸ¥è¯†æ£€ç´¢å¢å¼º

```python
# BM25 + Embedding æ··åˆæ£€ç´¢
1. PDFåŸæ–‡æ™ºèƒ½åˆ†å—ï¼ˆChunkingServiceï¼‰
2. ç”Ÿæˆ Embedding å‘é‡å­˜å‚¨
3. BM25 å…³é”®è¯åŒ¹é… + Embedding è¯­ä¹‰åŒ¹é…
4. æ··åˆè¯„åˆ†æ’åº
5. Top-K æ®µè½æ³¨å…¥ Prompt
6. å›å¤æœ«å°¾æ ‡æ³¨æ¥æº
```

---

### ä¸‰ã€é”€å”®å®æˆ˜æ¼”ç»ƒ (Sales Training)

#### 3.1 äº”é˜¶æ®µé”€å”®æµç¨‹æ§åˆ¶ (Stage Controller)

ç³»ç»Ÿå†…ç½®æ ‡å‡†çš„é”€å”®å…¨æµç¨‹ç®¡ç†ï¼ŒæŒ‡å¯¼ç”¨æˆ·å¾ªåºæ¸è¿›åœ°å®Œæˆé”€å”®ä»»åŠ¡ï¼š

1. **ä¿¡ä»»ä¸å…³ç³»å»ºç«‹ (Trust Building)**ï¼šåˆ¤æ–­æ²Ÿé€šæ„æ„¿ï¼Œå»ºç«‹å¯¹è¯åŸºç¡€
2. **ä¿¡æ¯æ¢ç´¢ä¸éœ€æ±‚è¯Šæ–­ (Needs Diagnosis)**ï¼šæŒ–æ˜å®¢æˆ·ç—›ç‚¹ï¼Œæ˜ç¡®é¢„ç®—ä¸æ—¶é—´
3. **ä»·å€¼å‘ˆç°ä¸æ–¹æ¡ˆé“¾æ¥ (Value Presentation)**ï¼šå»ºç«‹éœ€æ±‚ä¸äº§å“çš„å…³è”
4. **å¼‚è®®/é¡¾è™‘å¤„ç† (Objection Handling)**ï¼šè¯†åˆ«å¹¶åŒ–è§£å®¢æˆ·ç–‘è™‘
5. **æ”¶å°¾ä¸æˆäº¤ (Closing)**ï¼šæ˜ç¡®ä¸‹ä¸€æ­¥è¡ŒåŠ¨ï¼Œè¾¾æˆåˆä½œæ„å‘

#### 3.2 å®æ—¶è¯„ä»·å¼•æ“ (Evaluation Engine)

åŸºäº Qwen-Plus çš„æ™ºèƒ½è¯„ä»·ç³»ç»Ÿï¼Œå¯¹æ¯ä¸€è½®å¯¹è¯è¿›è¡Œå®æ—¶åˆ†æï¼š

```python
# è¯„åˆ†ç»´åº¦ (1-5åˆ†)
SCORING_CRITERIA = {
    "trust": "ä¿¡ä»»ä¸å…³ç³»å»ºç«‹",
    "needs": "ä¿¡æ¯æ¢ç´¢ä¸éœ€æ±‚è¯Šæ–­",
    "value": "ä»·å€¼å‘ˆç°ä¸æ–¹æ¡ˆé“¾æ¥",
    "objection": "å¼‚è®®/é¡¾è™‘å¤„ç†ç®¡ç†",
    "closing": "è¿›ç¨‹æ¨è¿›ä¸èŠ‚å¥ç®¡ç†"
}

# åˆ†æè¾“å‡º
{
    "quality": "good",  # fair/good/excellent
    "issues": ["æœªç¡®è®¤å®¢æˆ·é¢„ç®—", "å›åº”å¼‚è®®ä¸å¤Ÿåšå®š"],
    "suggestions": ["è¯•ç€è¯¢é—®ï¼šæ‚¨çš„é¢„ç®—èŒƒå›´å¤§æ¦‚æ˜¯å¤šå°‘ï¼Ÿ"],
    "score": 4
}
```

#### 3.3 AI é”€å”®åŠ©æ‰‹ (Sales Copilot)

åŸºäº RAG çš„æ™ºèƒ½é”€å”®çŸ¥è¯†åº“ç³»ç»Ÿï¼š

**åŠŸèƒ½ç‰¹æ€§ï¼š**
- **çŸ¥è¯†åº“ä¸Šä¼ **ï¼šæ”¯æŒ PDF/XLSX æ ¼å¼çš„é”€å”®èµ„æ–™
- **æ™ºèƒ½æ£€ç´¢**ï¼šBM25 + Embedding æ··åˆæ£€ç´¢
- **å®æ—¶å»ºè®®**ï¼šæ ¹æ®å¯¹è¯ä¸Šä¸‹æ–‡ç”Ÿæˆé”€å”®è¯æœ¯å»ºè®®
- **ææ–™æ¨è**ï¼šæŒ‰é˜¶æ®µæ¨è SOPã€è¯æœ¯ã€Q&Aã€ä»·æ ¼è¡¨ç­‰

**å»ºè®®ç”Ÿæˆæµç¨‹ï¼š**
```python
1. åˆ†æå½“å‰å¯¹è¯ä¸Šä¸‹æ–‡
2. æ£€ç´¢ç›¸å…³é”€å”®çŸ¥è¯†
3. ç”Ÿæˆ 3 æ¡å…·ä½“å»ºè®®
4. é™„å¸¦ä½¿ç”¨ç†ç”±å’Œæ³¨æ„äº‹é¡¹
```

#### 3.4 æ²‰æµ¸å¼å®¢æˆ·æ¨¡æ‹Ÿ

Customer Agent åŸºäºè¯¦ç»†ç”»åƒæ¨¡æ‹ŸçœŸå®å®¢æˆ·ååº”ï¼š
- **æ€§æ ¼ç‰¹å¾**ï¼šä¿å®ˆ/å¼€æ”¾/æŒ‘å‰”
- **ç—›ç‚¹éœ€æ±‚**ï¼šå…·ä½“çš„ä¸šåŠ¡ç—›ç‚¹
- **é˜²å¾¡æœºåˆ¶**ï¼šæ¨¡æ‹ŸçœŸå®å®¢æˆ·çš„æ‹’ç»å’Œè¿Ÿç–‘

---

#### 3.5 ç»¼åˆè¯„ä»·æŠ¥å‘Š

è®­ç»ƒç»“æŸåç”Ÿæˆè¯¦ç»†çš„è¯„ä»·æŠ¥å‘Šï¼š

**è¯„ä»·ç»´åº¦ï¼š**
- **æ€»åˆ†**ï¼š25 åˆ†åˆ¶ï¼ˆ5 ä¸ªé˜¶æ®µå„ 5 åˆ†ï¼‰
- **è¡¨ç°ç­‰çº§**ï¼šä¼˜ç§€/è‰¯å¥½/ä¸€èˆ¬/è¾ƒå·®
- **é›·è¾¾å›¾**ï¼š5 ç»´èƒ½åŠ›å¯è§†åŒ–
- **ä¼˜åŠ¿åˆ†æ**ï¼šæ ¸å¿ƒä¼˜åŠ¿æ€»ç»“
- **æ”¹è¿›å»ºè®®**ï¼šå…·ä½“æå‡æ–¹å‘
- **æœªå®Œæˆä»»åŠ¡**ï¼šå¾…æ”¹è¿›äº‹é¡¹

---

### å››ã€æ•°å­—å®¢æœ (Customer Service)

#### 4.1 ç³»ç»Ÿæ¦‚è¿°

æ•°å­—å®¢æœé‡‡ç”¨**"ä»£ç æ§åˆ¶æµç¨‹ï¼ŒLLMåªè´Ÿè´£æ”¹å†™"**çš„è®¾è®¡ç†å¿µï¼Œé€šè¿‡ç¡¬æ€§ä»£ç è§„åˆ™ç¡®ä¿è¯æœ¯éµå¾ªåº¦å’ŒæœåŠ¡è´¨é‡ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ ¸å¿ƒè®¾è®¡ç†å¿µ                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âœ— ä¼ ç»Ÿæ–¹å¼: è®© LLM è‡ªç”±å‘æŒ¥ â†’ ä¸å¯æ§                   â”‚
â”‚  âœ“ æœ¬ç³»ç»Ÿ: ä»£ç æ§åˆ¶å†³ç­– + LLM åªè´Ÿè´£æ”¹å†™ â†’ é«˜å¯æ§       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.2 BM25 + Embedding æ··åˆåŒ¹é…

é‡‡ç”¨ä¸‰å±‚æ··åˆåŒ¹é…æ¶æ„ï¼š

```
ç”¨æˆ·é—®é¢˜: "å­©å­æŒ‘é£Ÿæ€ä¹ˆåŠï¼Ÿ"
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. BM25 å…³é”®è¯åŒ¹é… (æƒé‡ 60%)       â”‚
â”‚     jiebaåˆ†è¯ â†’ å…³é”®è¯åŒ¹é… â†’ å½’ä¸€åŒ–  â”‚
â”‚     å¾—åˆ†: 0.8                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. Embedding è¯­ä¹‰åŒ¹é… (æƒé‡ 40%)    â”‚
â”‚     text-embedding-v2 â†’ ä½™å¼¦ç›¸ä¼¼åº¦  â”‚
â”‚     å¾—åˆ†: 0.9                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. æ··åˆè¯„åˆ†                         â”‚
â”‚     0.6 Ã— 0.8 + 0.4 Ã— 0.9 = 0.84    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.3 ç½®ä¿¡åº¦åˆ†å±‚ç­–ç•¥

| ç½®ä¿¡åº¦èŒƒå›´ | ç±»å‹ | å¤„ç†ç­–ç•¥ | LLMè°ƒç”¨ |
|-----------|------|---------|--------|
| **â‰¥ 0.9** | é«˜ç½®ä¿¡åº¦ | ç›´æ¥è¿”å›æ ‡å‡†è¯æœ¯ + é£é™©æç¤º | å¦ |
| **0.6-0.9** | ä¸­ç½®ä¿¡åº¦ | LLM ä¸¥æ ¼æ”¹å†™è¯æœ¯ | æ˜¯ |
| **< 0.6** | ä½ç½®ä¿¡åº¦ | LLM å°è¯•ç†è§£ + å¼•å¯¼é‡æ–°æé—® | æ˜¯ |
| **æ— åŒ¹é…** | - | è¿”å›å¼•å¯¼æ¶ˆæ¯ | å¦ |

**é«˜ç½®ä¿¡åº¦ç¤ºä¾‹ï¼š**
```
ç”¨æˆ·: å¯¹æŠ¥å‘Šå’Œæ–¹æ¡ˆæœ‰ä¸æ¸…æ¥šçš„åœ°æ–¹æ€ä¹ˆåŠï¼Ÿ
ç½®ä¿¡åº¦: 0.96 (high_confidence)
å›å¤: [ç›´æ¥è¿”å›CSVä¸­çš„æ ‡å‡†è¯æœ¯]
```

**ä¸­ç½®ä¿¡åº¦ç¤ºä¾‹ï¼š**
```
ç”¨æˆ·: å®å®ä¸çˆ±åƒè”¬èœå’‹æ•´ï¼Ÿ
ç½®ä¿¡åº¦: 0.75 (mid_confidence)
å›å¤: [LLMåŸºäºæ ‡å‡†è¯æœ¯æ”¹å†™ï¼Œæ›´å£è¯­åŒ–]
```

#### 4.4 æ™ºèƒ½è½¬äººå·¥

è½¬äººå·¥åˆ¤æ–­é‡‡ç”¨**ç¡¬æ€§è§„åˆ™**ï¼Œä¸ä¾èµ–ç½®ä¿¡åº¦ï¼š

```python
# æ¡ä»¶1: ç”¨æˆ·æ˜ç¡®è¦æ±‚
å…³é”®è¯: ['äººå·¥', 'è½¬äººå·¥', 'å®¢æœ', 'çœŸäºº', 'è½¬æ¥']

# æ¡ä»¶2: ç”¨æˆ·è¡¨è¾¾ä¸æ»¡
å…³é”®è¯: ['ä¸æ»¡æ„', 'æŠ•è¯‰', 'å·®è¯„', 'é€€æ¬¾', 'åƒåœ¾']

# æ³¨æ„: ä½ç½®ä¿¡åº¦ä¸è½¬äººå·¥ï¼Œè€Œæ˜¯å¼•å¯¼ç”¨æˆ·é‡æ–°æè¿°é—®é¢˜
```

#### 4.5 CSV æ•°æ®å¯¼å…¥

**CSV æ ¼å¼è§„èŒƒï¼š**

| åˆ— | å­—æ®µå | è¯´æ˜ | ç¤ºä¾‹ |
|---|-------|------|------|
| 1 | question_count | æé—®æ¬¡æ•° | 15 |
| 2 | topic_name | ä¸»é¢˜åç§° | å­©å­æŒ‘é£Ÿä¸åƒè”¬èœ |
| 3 | typical_question | å…¸å‹æé—® | å­©å­ä¸çˆ±åƒè”¬èœæ€ä¹ˆåŠï¼Ÿ |
| 4 | standard_script | æ ‡å‡†è¯æœ¯ | å¯ä»¥å°è¯•å°†è”¬èœåˆ‡ç¢... |
| 5 | risk_notes | é£é™©æ³¨æ„äº‹é¡¹ | é•¿æœŸæ‹’é£Ÿå¯èƒ½å¯¼è‡´... |

**å¯¼å…¥æµç¨‹ï¼š**

```
CSVä¸Šä¼ 
    â”‚
    â–¼
1. è§£æ5åˆ—æ•°æ® + éªŒè¯
    â”‚
    â–¼
2. jiebaåˆ†è¯ â†’ æå–å…³é”®è¯ (Top 20)
    â”‚
    â–¼
3. DashScope API â†’ ç”Ÿæˆ Embedding (1536ç»´)
    â”‚
    â–¼
4. æ‰¹é‡æ’å…¥æ•°æ®åº“
    â”‚
    â–¼
5. MD5 æ³¨å†Œ (é˜²é‡å¤å¯¼å…¥)
```

#### 4.6 ä¼šè¯ç®¡ç†ä¸ç»Ÿè®¡

```python
# ä¼šè¯æ•°æ®
{
    "session_id": "uuid",
    "start_time": "2026-01-20 10:00:00",
    "message_count": 5,
    "avg_confidence": 0.78,
    "transfer_to_human": False,
    "user_rating": 4
}

# ç»Ÿè®¡åˆ†æ
{
    "total_sessions": 100,
    "avg_confidence": 0.78,
    "transfer_rate": 5.0%,
    "match_type_distribution": {
        "high_confidence": 40%,
        "mid_confidence": 50%,
        "low_confidence": 8%,
        "no_match": 2%
    }
}
```

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### åç«¯

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| FastAPI | 0.115 | Web æ¡†æ¶ & WebSocket |
| DashScope | 1.22 | é˜¿é‡Œäº‘ LLM (Qwen-Max/Turbo) + Embedding + Audio |
| Volcano Engine | - | ç«å±±å¼•æ“æ•°å­—äººè§†é¢‘ç”Ÿæˆ (Image to Video) |
| SQLAlchemy | 2.0 | å¼‚æ­¥æ•°æ®åº“ ORM |
| aiosqlite | 0.19 | å¼‚æ­¥ SQLite é©±åŠ¨ |
| PyMuPDF | - | PDF æ–‡æœ¬æå– |
| rank-bm25 | 0.2.2 | BM25 ç®—æ³•å®ç° |
| jieba | 0.42 | ä¸­æ–‡åˆ†è¯ |
| numpy | 1.24 | å‘é‡è®¡ç®— |
| tenacity | 8.2 | å¤±è´¥é‡è¯•æœºåˆ¶ |
| Loguru | 0.7 | æ—¥å¿—è®°å½• |

### å‰ç«¯

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| React | 18 | UI æ¡†æ¶ |
| Vite | 5 | æ„å»ºå·¥å…· |
| Material-UI | 5 | UI ç»„ä»¶åº“ |
| React Router | 6 | è·¯ç”±ç®¡ç† |
| react-use-websocket | - | WebSocket è¿æ¥ |

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„å›¾

```mermaid
graph TD
    subgraph Frontend["å‰ç«¯ (React)"]
        GroupChat[æ™ºèƒ½ç¾¤èŠé¡µé¢]
        Celebrity[æ•°å­—åˆ†èº«é¡µé¢]
        SalesCopilot[é”€å”®æ¼”ç»ƒé¡µé¢]
        CustomerService[æ•°å­—å®¢æœé¡µé¢]
    end

    subgraph Backend["åç«¯ (FastAPI)"]
        WS1["/ws ç¾¤èŠ"]
        WS2["/ws/celebrity åˆ†èº«"]
        WS3["/ws/customer-service å®¢æœ"]
        WS4["/ws/training æ¼”ç»ƒ"]

        subgraph Services["æ ¸å¿ƒæœåŠ¡"]
            Orchestrator[ç¾¤èŠç¼–æ’å™¨]
            CelebrityOrch[åˆ†èº«ç¼–æ’å™¨]
            CSOrch[å®¢æœç¼–æ’å™¨]
            TrainingOrch[åŸ¹è®­ç¼–æ’å™¨]

            Agent[AgentæœåŠ¡]
            CelebrityAgent[åˆ†èº«Agent]
            CustomerAgent[å®¢æˆ·Agent]

            QAMatcher[QAåŒ¹é…å¼•æ“]
            ResponseGen[å›å¤ç”Ÿæˆå™¨]
            EvaluationEng[è¯„ä»·å¼•æ“]
            
            Router[LLMè·¯ç”±]
            VideoSvc[è§†é¢‘ç”ŸæˆæœåŠ¡]
        end

        subgraph Data["æ•°æ®å±‚"]
            DB[(SQLite)]
            Embedding[EmbeddingæœåŠ¡]
        end
    end

    subgraph External["å¤–éƒ¨æœåŠ¡"]
        QwenMax[Qwen-Max]
        QwenTurbo[Qwen-Turbo]
        EmbeddingAPI[text-embedding-v2]
    end

    GroupChat --> WS1
    Celebrity --> WS2
    CustomerService --> WS3

    WS1 --> Orchestrator
    WS2 --> CelebrityOrch
    WS3 --> CSOrch

    Orchestrator --> Agent
    Orchestrator --> Router
    Orchestrator --> Guardrail

    CelebrityOrch --> CelebrityAgent
    CelebrityOrch --> PDFParser

    CSOrch --> QAMatcher
    CSOrch --> ResponseGen
    CSOrch --> SessionMgr

    Agent --> QwenMax
    CelebrityAgent --> QwenMax
    Router --> QwenTurbo
    ResponseGen --> QwenTurbo

    QAMatcher --> Embedding
    PDFParser --> QwenMax
    Embedding --> EmbeddingAPI

    QAMatcher --> DB
    SessionMgr --> DB
    CelebrityOrch --> DB
```

### ç›®å½•ç»“æ„

```bash
VividCrowd/
â”œâ”€â”€ backend/                              # Python åç«¯
â”‚   â”œâ”€â”€ main.py                          # FastAPI ä¸»å…¥å£
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ config.py                    # å…¨å±€é…ç½®
â”‚   â”‚   â””â”€â”€ database.py                  # æ•°æ®åº“è¿æ¥ç®¡ç†
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ db_models.py                 # SQLAlchemy æ•°æ®åº“æ¨¡å‹
â”‚   â”‚   â””â”€â”€ schemas.py                   # Pydantic æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ apps/                            # å››å¤§åº”ç”¨æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ chat/                        # æ™ºèƒ½ç¾¤èŠ
â”‚   â”‚   â”‚   â”œâ”€â”€ app.py                   # ç¾¤èŠåº”ç”¨å…¥å£
â”‚   â”‚   â”‚   â””â”€â”€ services/
â”‚   â”‚   â”‚       â”œâ”€â”€ orchestrator.py      # ç¾¤èŠç¼–æ’å™¨
â”‚   â”‚   â”‚       â”œâ”€â”€ agent.py             # Agent æœåŠ¡
â”‚   â”‚   â”‚       â”œâ”€â”€ router.py            # LLM è·¯ç”±
â”‚   â”‚   â”‚       â””â”€â”€ guardrail.py         # å®‰å…¨å›´æ 
â”‚   â”‚   â”œâ”€â”€ celebrity/                   # æ•°å­—åˆ†èº«
â”‚   â”‚   â”‚   â”œâ”€â”€ app.py                   # åˆ†èº«åº”ç”¨å…¥å£
â”‚   â”‚   â”‚   â””â”€â”€ services/
â”‚   â”‚   â”‚       â”œâ”€â”€ celebrity_orchestrator.py
â”‚   â”‚   â”‚       â”œâ”€â”€ celebrity_agent.py
â”‚   â”‚   â”‚       â”œâ”€â”€ celebrity_retriever.py
â”‚   â”‚   â”‚       â”œâ”€â”€ pdf_parser.py
â”‚   â”‚   â”‚       â”œâ”€â”€ chunking_service.py
â”‚   â”‚   â”‚       â”œâ”€â”€ video_service.py     # æ•°å­—äººè§†é¢‘
â”‚   â”‚   â”‚       â”œâ”€â”€ audio_service.py     # TTS/ASR
â”‚   â”‚   â”‚       â””â”€â”€ session_manager.py
â”‚   â”‚   â”œâ”€â”€ customer_service/            # æ•°å­—å®¢æœ
â”‚   â”‚   â”‚   â”œâ”€â”€ app.py                   # å®¢æœåº”ç”¨å…¥å£
â”‚   â”‚   â”‚   â””â”€â”€ services/
â”‚   â”‚   â”‚       â”œâ”€â”€ orchestrator.py
â”‚   â”‚   â”‚       â”œâ”€â”€ qa_matcher.py        # QA åŒ¹é…å¼•æ“
â”‚   â”‚   â”‚       â”œâ”€â”€ response_generator.py
â”‚   â”‚   â”‚       â”œâ”€â”€ session_manager.py
â”‚   â”‚   â”‚       â”œâ”€â”€ embedding_service.py
â”‚   â”‚   â”‚       â”œâ”€â”€ excel_importer.py
â”‚   â”‚   â”‚       â””â”€â”€ csv_registry.py
â”‚   â”‚   â””â”€â”€ digital_customer/            # é”€å”®æ¼”ç»ƒ
â”‚   â”‚       â”œâ”€â”€ app.py                   # æ¼”ç»ƒåº”ç”¨å…¥å£
â”‚   â”‚       â””â”€â”€ services/
â”‚   â”‚           â”œâ”€â”€ customer_orchestrator.py
â”‚   â”‚           â”œâ”€â”€ customer_agent.py
â”‚   â”‚           â”œâ”€â”€ customer_retriever.py
â”‚   â”‚           â”œâ”€â”€ profile_parser.py
â”‚   â”‚           â”œâ”€â”€ chunking_service.py
â”‚   â”‚           â”œâ”€â”€ audio_service.py
â”‚   â”‚           â””â”€â”€ training/            # åŸ¹è®­æ¨¡å—
â”‚   â”‚               â”œâ”€â”€ training_orchestrator.py
â”‚   â”‚               â”œâ”€â”€ evaluation_engine.py
â”‚   â”‚               â”œâ”€â”€ stage_controller.py
â”‚   â”‚               â”œâ”€â”€ knowledge_service.py
â”‚   â”‚               â””â”€â”€ suggestion_generator.py
â”‚   â”œâ”€â”€ data/                            # æ•°æ®åº“æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ celebrity.db                 # æ•°å­—åˆ†èº«æ•°æ®åº“
â”‚   â”‚   â”œâ”€â”€ customerService.db           # å®¢æœæ•°æ®åº“
â”‚   â”‚   â””â”€â”€ digital_customer.db          # é”€å”®æ¼”ç»ƒæ•°æ®åº“
â”‚   â”œâ”€â”€ agents_profiles.json             # ç¾¤èŠ Agent äººè®¾
â”‚   â””â”€â”€ requirements.txt
â”‚
â”œâ”€â”€ frontend/                            # React å‰ç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.jsx              # ä¾§è¾¹æ å¯¼èˆª
â”‚   â”‚   â”‚   â”œâ”€â”€ training/                # é”€å”®æ¼”ç»ƒç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ StageIndicator.jsx   # é˜¶æ®µæŒ‡ç¤ºå™¨
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RealTimeFeedback.jsx # å®æ—¶åé¦ˆ
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SalesCopilot.jsx     # AI åŠ©æ‰‹
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SalesMaterialsPanel.jsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ RadarChart.jsx       # é›·è¾¾å›¾
â”‚   â”‚   â”‚   â”œâ”€â”€ celebrity/               # æ•°å­—åˆ†èº«ç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CelebrityCard.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CelebrityUpload.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CelebritySelector.jsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ChatModeToggle.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ digital_customer/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ DigitalCustomerUpload.jsx
â”‚   â”‚   â”‚   â””â”€â”€ common/
â”‚   â”‚   â”‚       â”œâ”€â”€ AudioInput.jsx       # è¯­éŸ³è¾“å…¥
â”‚   â”‚   â”‚       â””â”€â”€ ConnectionStatus.jsx
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â”œâ”€â”€ useCelebrityWebSocket.js
â”‚   â”‚   â”‚   â”œâ”€â”€ useCustomerServiceWS.js
â”‚   â”‚   â”‚   â””â”€â”€ useWebSocketWithRetry.js
â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”‚   â”œâ”€â”€ GroupChatPage.jsx        # æ™ºèƒ½ç¾¤èŠ
â”‚   â”‚   â”‚   â”œâ”€â”€ CelebrityPage.jsx        # æ•°å­—åˆ†èº«
â”‚   â”‚   â”‚   â”œâ”€â”€ CustomerServicePage.jsx  # æ•°å­—å®¢æœ
â”‚   â”‚   â”‚   â”œâ”€â”€ DigitalCustomerPage.jsx  # é”€å”®æ¼”ç»ƒ
â”‚   â”‚   â”‚   â””â”€â”€ Training/
â”‚   â”‚   â”‚       â””â”€â”€ EvaluationReportPage.jsx
â”‚   â”‚   â”œâ”€â”€ config.js
â”‚   â”‚   â”œâ”€â”€ App.jsx
â”‚   â”‚   â””â”€â”€ main.jsx
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ README.md                            # ä¸­æ–‡æ–‡æ¡£
â””â”€â”€ README_EN.md                         # English Documentation
```

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### å‰ç½®è¦æ±‚

- **Python 3.9+**
- **Node.js 16+**
- **é˜¿é‡Œäº‘ DashScope API Key** ([ç”³è¯·åœ°å€](https://dashscope.console.aliyun.com/))

### å®‰è£…ä¸è¿è¡Œ

**1. å…‹éš†é¡¹ç›®**

```bash
git clone https://github.com/your-username/VividCrowd.git
cd VividCrowd
```

**2. åç«¯è®¾ç½®**

```bash
cd backend
pip install -r requirements.txt

# è®¾ç½® API Key
# Windows PowerShell
$env:DASHSCOPE_API_KEY="your_api_key_here"

# Linux/Mac
export DASHSCOPE_API_KEY="your_api_key_here"

# å¯åŠ¨æœåŠ¡å™¨
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

**3. å‰ç«¯è®¾ç½®**

```bash
cd frontend
npm install
npm run dev
```

**4. è®¿é—®åº”ç”¨**

æµè§ˆå™¨æ‰“å¼€ `http://localhost:5173`

---

## ğŸ“¡ API æ¥å£æ–‡æ¡£

### REST API

#### æ™ºèƒ½ç¾¤èŠ (`/api/chat`)
| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|------|------|------|
| GET | `/api/chat/agents` | è·å–æ‰€æœ‰ç¾¤èŠ Agent ä¿¡æ¯ |

#### æ•°å­—åˆ†èº« (`/api/celebrity`)
| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|------|------|------|
| GET | `/api/celebrity` | è·å–æ‰€æœ‰æ•°å­—åˆ†èº«åˆ—è¡¨ |
| GET | `/api/celebrity/{id}` | è·å–æŒ‡å®šæ•°å­—åˆ†èº«è¯¦æƒ… |
| POST | `/api/celebrity/upload` | ä¸Šä¼  PDF åˆ›å»ºæ•°å­—åˆ†èº« |
| DELETE | `/api/celebrity/{id}` | åˆ é™¤æ•°å­—åˆ†èº« |
| POST | `/api/celebrity/digital-human/generate-video` | ç”Ÿæˆæ•°å­—äººè§†é¢‘ |
| POST | `/api/celebrity/digital-human/transcribe-audio` | è¯­éŸ³è½¬æ–‡å­— |

#### æ•°å­—å®¢æœ (`/api/customer-service`)
| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|------|------|------|
| GET | `/api/customer-service/stats` | è·å–ç»Ÿè®¡æ•°æ® |
| GET | `/api/customer-service/qa/count` | è·å– QA è®°å½•æ•° |
| POST | `/api/customer-service/session` | åˆ›å»ºæ–°ä¼šè¯ |
| GET | `/api/customer-service/session/{id}/history` | è·å–ä¼šè¯å†å² |
| POST | `/api/customer-service/session/{id}/rating` | æäº¤ç”¨æˆ·è¯„åˆ† |

#### é”€å”®æ¼”ç»ƒ (`/api/digital-customer`)
| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|------|------|------|
| GET | `/api/digital-customer` | è·å–æ‰€æœ‰å®¢æˆ·æ¡£æ¡ˆ |
| GET | `/api/digital-customer/{id}` | è·å–å®¢æˆ·è¯¦æƒ… |
| POST | `/api/digital-customer/upload` | ä¸Šä¼ å®¢æˆ·æ¡£æ¡ˆ |
| DELETE | `/api/digital-customer/{id}` | åˆ é™¤å®¢æˆ·æ¡£æ¡ˆ |
| POST | `/api/digital-customer/knowledge/upload` | ä¸Šä¼ é”€å”®çŸ¥è¯†åº“ |
| GET | `/api/digital-customer/knowledge/files` | è·å–çŸ¥è¯†æ–‡ä»¶åˆ—è¡¨ |
| POST | `/api/digital-customer/knowledge/query` | æŸ¥è¯¢çŸ¥è¯†åº“ |
| POST | `/api/digital-customer/training/sessions/start` | å¼€å§‹åŸ¹è®­ä¼šè¯ |
| GET | `/api/digital-customer/training/sessions` | è·å–åŸ¹è®­è®°å½• |
| GET | `/api/digital-customer/training/sessions/{id}/evaluation` | è·å–è¯„ä»·æŠ¥å‘Š |
| POST | `/api/digital-customer/audio/transcribe` | è¯­éŸ³è½¬æ–‡å­— |
| POST | `/api/digital-customer/audio/synthesize` | æ–‡å­—è½¬è¯­éŸ³ |

### WebSocket ç«¯ç‚¹

#### æ™ºèƒ½ç¾¤èŠ (`/api/chat/ws`)

**å‘é€ï¼š** çº¯æ–‡æœ¬æ¶ˆæ¯

**æ¥æ”¶ï¼š**
```json
{"type": "stream_start", "sender": "å°æ—", "content": ""}
{"type": "stream_chunk", "sender": "å°æ—", "content": "å§å¦¹"}
{"type": "stream_end", "sender": "å°æ—", "content": ""}
```

#### æ•°å­—åˆ†èº« (`/api/celebrity/ws`)

**å‘é€ï¼š**
```json
{
  "message": "å¦‚ä½•çœ‹å¾…äººå·¥æ™ºèƒ½ï¼Ÿ",
  "celebrity_ids": [1, 2, 3],
  "mode": "private|group"
}
```

**æ¥æ”¶ï¼š** åŒä¸Š

#### æ•°å­—å®¢æœ (`/api/customer-service/ws`)

**å‘é€ï¼š**
```json
{"message": "å­©å­æŒ‘é£Ÿæ€ä¹ˆåŠï¼Ÿ"}
```

**æ¥æ”¶ï¼š**
```json
{"type": "session_created", "session_id": "uuid"}
{"type": "response", "content": "...", "confidence": 0.85, "match_type": "mid_confidence"}
```

#### é”€å”®æ¼”ç»ƒ - å®¢æˆ·å¯¹è¯ (`/api/digital-customer/ws`)

**å‘é€ï¼š**
```json
{"message": "ä½ å¥½ï¼Œæˆ‘æƒ³äº†è§£ä¸€ä¸‹ä½ ä»¬çš„äº§å“"}
```

**æ¥æ”¶ï¼š** åŒç¾¤èŠæ ¼å¼

#### é”€å”®æ¼”ç»ƒ - åŸ¹è®­æ¨¡å¼ (`/api/digital-customer/training/ws/{session_id}`)

**å‘é€ï¼š**
```json
{"message": "æ‚¨å¥½ï¼Œè¯·é—®æ‚¨æœ€è¿‘åœ¨ä¸šåŠ¡ä¸Šæœ‰ä»€ä¹ˆå›°æ‰°å—ï¼Ÿ"}
```

**æ¥æ”¶ï¼š**
```json
{
  "type": "evaluation",
  "quality": "good",
  "issues": ["æœªç¡®è®¤é¢„ç®—"],
  "suggestions": ["è¯¢é—®é¢„ç®—èŒƒå›´"],
  "score": 4
}
{
  "type": "customer_response",
  "content": "...",
  "audio_url": "https://..."
}
{
  "type": "stage_completed",
  "stage": 1,
  "next_stage": 2
}
```

---

## âš™ï¸ é…ç½®æŒ‡å—

### åç«¯é…ç½® (`backend/core/config.py`)

```python
# API å¯†é’¥
DASHSCOPE_API_KEY = os.getenv("DASHSCOPE_API_KEY")  # é˜¿é‡Œäº‘ DashScope

# LLM æ¨¡å‹é…ç½®
MODEL_NAME = "qwen-max"                    # ä¸»å›å¤æ¨¡å‹
ROUTER_MODEL_NAME = "qwen-turbo"           # è·¯ç”±æ¨¡å‹
EVALUATION_MODEL = "qwen-plus"             # è¯„ä»·æ¨¡å‹

# ç¾¤èŠé…ç½®
STRICT_PERSONA_CHECK = True                # ä¸¥æ ¼äººè®¾æ£€æŸ¥
ENABLE_LLM_ROUTING = True                  # LLM è¯­ä¹‰è·¯ç”±
MIN_TYPING_DELAY = 8.0                     # æœ€å°æ‰“å­—å»¶è¿Ÿ (ç§’)
MAX_TYPING_DELAY = 10.0                    # æœ€å¤§æ‰“å­—å»¶è¿Ÿ (ç§’)
MAX_AGENTS_PER_ROUND = 3                   # æ¯è½®æœ€å¤šå›å¤äººæ•°

# æ·±å¤œæ¨¡å¼
NIGHT_MODE_START_HOUR = 23
NIGHT_MODE_END_HOUR = 7
NIGHT_MODE_PROBABILITY = 0.2               # æ·±å¤œæ´»è·ƒæ¦‚ç‡

# å®¢æœé…ç½®
HIGH_CONFIDENCE_THRESHOLD = 0.9            # é«˜ç½®ä¿¡åº¦é˜ˆå€¼
MID_CONFIDENCE_THRESHOLD = 0.6             # ä¸­ç½®ä¿¡åº¦é˜ˆå€¼
BM25_WEIGHT = 0.6                          # BM25 æƒé‡
EMBEDDING_WEIGHT = 0.4                     # Embedding æƒé‡

# æ•°å­—äººé…ç½®ï¼ˆç«å±±å¼•æ“ï¼‰
CELEBRITY_VOLCENGINE_ACCESS_KEY = os.getenv("VOLCENGINE_ACCESS_KEY")
CELEBRITY_VOLCENGINE_SECRET_KEY = os.getenv("VOLCENGINE_SECRET_KEY")

# OSS é…ç½®ï¼ˆé˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨ï¼‰
CELEBRITY_OSS_ACCESS_KEY_ID = os.getenv("OSS_ACCESS_KEY_ID")
CELEBRITY_OSS_ACCESS_KEY_SECRET = os.getenv("OSS_ACCESS_KEY_SECRET")
CELEBRITY_OSS_BUCKET_NAME = os.getenv("OSS_BUCKET_NAME")
CELEBRITY_OSS_ENDPOINT = os.getenv("OSS_ENDPOINT")
```

### å‰ç«¯é…ç½® (`frontend/src/config.js`)

```javascript
export const CONFIG = {
  API_BASE_URL: 'http://localhost:8000',
  WS_URL: 'ws://localhost:8000/api/chat/ws',
  CELEBRITY_WS_URL: 'ws://localhost:8000/api/celebrity/ws',
  CUSTOMER_SERVICE_WS_URL: 'ws://localhost:8000/api/customer-service/ws',
  DIGITAL_CUSTOMER_WS_URL: 'ws://localhost:8000/api/digital-customer/ws',
  TRAINING_WS_URL: 'ws://localhost:8000/api/digital-customer/training/ws'
};
```

---

## ğŸ“Š æ•°æ®åº“æ¶æ„

### ä¸‰ä¸ªç‹¬ç«‹æ•°æ®åº“

æœ¬é¡¹ç›®é‡‡ç”¨**ä¸‰æ•°æ®åº“åˆ†ç¦»æ¶æ„**ï¼Œæ¯ä¸ªä¸šåŠ¡æ¨¡å—ä½¿ç”¨ç‹¬ç«‹çš„ SQLite æ•°æ®åº“ï¼š

#### 1. celebrity.dbï¼ˆæ•°å­—åˆ†èº«æ•°æ®åº“ï¼‰

| è¡¨å | ç”¨é€” |
|------|------|
| `knowledge_sources` | åäºº/ä¸“å®¶æ¡£æ¡ˆ |
| `celebrity_chunks` | æ–‡æ¡£åˆ†å—ä¸ Embedding |
| `chat_sessions` | ä¼šè¯è®°å½• |
| `chat_messages` | å¯¹è¯æ¶ˆæ¯ |

**å…³é”®å­—æ®µ (knowledge_sources):**
```sql
id, name, source_type, author, birth_year, death_year,
nationality, occupation, biography, famous_works, famous_quotes,
personality_traits, speech_style, system_prompt, raw_content
```

#### 2. customerService.dbï¼ˆå®¢æœæ•°æ®åº“ï¼‰

| è¡¨å | ç”¨é€” |
|------|------|
| `customer_service_qa` | QA çŸ¥è¯†åº“ |
| `customer_service_sessions` | ä¼šè¯è®°å½• |
| `customer_service_logs` | å¯¹è¯æ—¥å¿— |
| `csv_registry` | CSV æ–‡ä»¶å»é‡æ³¨å†Œ |

**å…³é”®å­—æ®µ (customer_service_qa):**
```sql
id, question_count, topic_name, typical_question,
standard_script, risk_notes, keywords, embedding, created_at
```

#### 3. digital_customer.dbï¼ˆé”€å”®æ¼”ç»ƒæ•°æ®åº“ï¼‰

| è¡¨å | ç”¨é€” |
|------|------|
| `customer_profiles` | å®¢æˆ·ç”»åƒæ¡£æ¡ˆ |
| `customer_chunks` | å®¢æˆ·æ¡£æ¡ˆåˆ†å— |
| `training_sessions` | åŸ¹è®­ä¼šè¯ |
| `conversation_rounds` | å¯¹è¯è½®æ¬¡è®°å½• |
| `stage_evaluations` | é˜¶æ®µè¯„ä»· |
| `final_evaluations` | ç»¼åˆè¯„ä»·æŠ¥å‘Š |
| `sales_knowledge` | é”€å”®çŸ¥è¯†åº“ |
| `customer_profile_registry` | å®¢æˆ·æ¡£æ¡ˆå»é‡æ³¨å†Œ |

**å…³é”®å­—æ®µ (training_sessions):**
```sql
id, customer_id, user_id, current_stage, stage_completion_rates,
start_time, end_time, status
```

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

| åœºæ™¯ | æ¨èæ¨¡å¼ | è¯´æ˜ |
|------|---------|------|
| å¨±ä¹ç¤¾äº¤ | æ™ºèƒ½ç¾¤èŠ | ä¸è™šæ‹Ÿç¾¤å‹é—²èŠã€è®¨è®º |
| å­¦ä¹ ç ”ç©¶ | æ•°å­—åˆ†èº«ï¼ˆç§èŠï¼‰ | ä¸å†å²äººç‰©ã€ä¹¦ç±ã€ä¸“å®¶æ·±åº¦å¯¹è¯ |
| å¤´è„‘é£æš´ | æ•°å­—åˆ†èº«ï¼ˆç¾¤èŠï¼‰ | å¤šä½ä¸“å®¶æ€æƒ³ç¢°æ’ |
| ä¼ä¸šå®¢æœ | æ•°å­—å®¢æœ | åŸºäºçŸ¥è¯†åº“çš„æ™ºèƒ½é—®ç­” |
| äº§å“å’¨è¯¢ | æ•°å­—å®¢æœ | æ ‡å‡†è¯æœ¯ + æ™ºèƒ½å¼•å¯¼ |
| é”€å”®åŸ¹è®­ | é”€å”®æ¼”ç»ƒ | æ¨¡æ‹ŸçœŸå®å®¢æˆ·ï¼Œå®æˆ˜æ¼”ç»ƒé”€å”®æŠ€å·§ |
| è¯æœ¯ä¼˜åŒ– | é”€å”®æ¼”ç»ƒ + AI åŠ©æ‰‹ | è·å–å®æ—¶å»ºè®®ï¼Œä¼˜åŒ–æ²Ÿé€šç­–ç•¥ |

---

## ğŸ¤ å‚ä¸è´¡çŒ®

æ¬¢è¿æäº¤ Pull Requestsï¼è¯·ç¡®ä¿ï¼š

1. Python ä»£ç ç¬¦åˆ PEP 8 è§„èŒƒ
2. æ–°åŠŸèƒ½åŒ…å«å¿…è¦çš„æµ‹è¯•
3. æ›´æ–°ç›¸å…³æ–‡æ¡£
4. **ä¸è¦**æäº¤åŒ…å«æ•æ„Ÿä¿¡æ¯çš„é…ç½®æ–‡ä»¶

---

## ğŸ“„ å¼€æºåè®®

æœ¬é¡¹ç›®åŸºäº [MIT License](LICENSE) å¼€æºã€‚

---

## ğŸ™ è‡´è°¢

- [é˜¿é‡Œäº‘ DashScope](https://dashscope.console.aliyun.com/) - LLM å’Œ Embedding æœåŠ¡
- [FastAPI](https://fastapi.tiangolo.com/) - é«˜æ€§èƒ½ Web æ¡†æ¶
- [React](https://react.dev/) - å‰ç«¯ UI æ¡†æ¶
- [Material-UI](https://mui.com/) - UI ç»„ä»¶åº“

---

## ğŸ“¬ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤ [Issue](https://github.com/your-username/VividCrowd/issues) æˆ–å‘èµ· [Discussion](https://github.com/your-username/VividCrowd/discussions)ã€‚
